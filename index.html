<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Генератор ANSI‑блоков для Discord</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #editor, #editor * { font-family: inherit; }
    .toolbar button { font-size: 1rem; }
    .toast { position: fixed; bottom: 1rem; left:50%; transform: translateX(-50%); background:rgba(0,0,0,0.8); color:#fff; padding:.5rem 1rem; border-radius:.5rem; opacity:0; transition:opacity .3s; }
    .toast.show { opacity:1; }
  </style>
</head>
<body class="bg-gray-100 p-4 min-h-screen">
  <h1 class="text-2xl font-bold mb-4 text-center">Генератор ANSI‑блоков для Discord</h1>
  <div class="max-w-4xl mx-auto">
    <div id="editor" contenteditable class="border border-gray-300 rounded-lg p-4 bg-white min-h-[300px] whitespace-pre-wrap"></div>
  </div>
  <div class="fixed top-20 right-4 w-60 bg-white p-4 rounded-lg shadow-lg toolbar">
    <button id="copy" class="w-full bg-green-600 text-white py-2 rounded-lg mb-2">Скопировать в Discord</button>
    <button id="clear-format" class="w-full bg-red-600 text-white py-2 rounded-lg mb-4">Очистить форматирование</button>
    <div class="mb-2 font-semibold">Цвет текста</div>
    <div id="fg-palette" class="grid grid-cols-4 gap-1 mb-4"></div>
    <div class="mb-2 font-semibold">Цвет фона</div>
    <div id="bg-palette" class="grid grid-cols-4 gap-1 mb-4"></div>
    <div class="mb-2 font-semibold">Стили</div>
    <div class="flex gap-2">
      <button id="bold" title="Жирный" class="flex-1 border rounded-lg py-1">B</button>
      <button id="underline" title="Подчёркнутый" class="flex-1 border rounded-lg py-1">U</button>
    </div>
  </div>
  <div id="toast" class="toast">Скопировано!</div>
<script>
  // Настройка execCommand
  const editor = document.getElementById('editor');
  const cmds = ['bold','underline'];
  document.getElementById('bold').onclick = () => document.execCommand('bold');
  document.getElementById('underline').onclick = () => document.execCommand('underline');
  function makePalette(id, cmd) {
    const colors = ['gray','red','green','yellow','blue','magenta','cyan','white'];
    const cont = document.getElementById(id);
    colors.forEach(c=>{
      const btn = document.createElement('button'); btn.className='w-8 h-8 rounded-lg border'; btn.style.backgroundColor=c;
      btn.onclick = ()=>{
        document.execCommand('styleWithCSS', true, null);
        document.execCommand(cmd, false, c);
      };
      cont.appendChild(btn);
    });
  }
  makePalette('fg-palette','foreColor');
  makePalette('bg-palette','hiliteColor');

  // Генерация ANSI
  const ESC='\u001b';
  const ansiMap = {
    'rgb(128, 128, 128)':30,'rgb(255, 0, 0)':31,'rgb(0, 128, 0)':32,'rgb(255, 255, 0)':33,
    'rgb(0, 0, 255)':34,'rgb(255, 0, 255)':35,'rgb(0, 255, 255)':36,'rgb(255, 255, 255)':37
  };
  function generate(root) {
    let out='';
    function walk(node){
      if(node.nodeType===3){ out+=node.textContent; return; }
      if(node.nodeType!==1) return;
      if(node.tagName==='BR'){ out+='\n'; return; }
      const style = window.getComputedStyle(node);
      const codes=[];
      if(style.fontWeight==='700' || style.fontWeight==='bold') codes.push('1');
      if(style.textDecorationLine.includes('underline')) codes.push('4');
      const fg = style.color;
      if(ansiMap[fg]!=null) codes.push(ansiMap[fg]);
      const bg = style.backgroundColor;
      const bgCode = ansiMap[bg]!=null? ansiMap[bg]+10:null;
      if(bgCode) codes.push(bgCode);
      if(codes.length){ out+='```ansi\n'+ESC+'['+codes.join(';')+'m'; Array.from(node.childNodes).forEach(walk); out+=ESC+'[0m\n```'; }
      else Array.from(node.childNodes).forEach(walk);
    }
    walk(root);
    return out;
  }
  document.getElementById('copy').onclick=()=>{
    const txt = generate(editor);
    navigator.clipboard.writeText(txt).then(()=>{ const t=document.getElementById('toast'); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500); });
  };
  document.getElementById('clear-format').onclick=()=>{
    document.execCommand('removeFormat',false,null);
  };
</script>
</body>
</html>
